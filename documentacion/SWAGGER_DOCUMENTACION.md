# üìö Documentaci√≥n Swagger de la API

Documentaci√≥n interactiva completa de todos los endpoints de la API usando Swagger/OpenAPI.

---

## üéØ ¬øQu√© es Swagger?

Swagger es una interfaz web interactiva que te permite:
- Ver todos los endpoints disponibles
- Ver ejemplos de request/response
- Probar endpoints directamente desde el navegador
- Autenticarte con JWT tokens
- Generar especificaciones OpenAPI

---

## üöÄ C√≥mo Acceder a Swagger

### Opci√≥n 1: Interfaz Web Interactiva (Recomendado)

```
http://localhost:5000/api/docs
```

**Abre tu navegador y visita esta URL**. Ver√°s una interfaz gr√°fica completa con todos los endpoints.

### Opci√≥n 2: Especificaci√≥n JSON (Para herramientas)

```bash
curl http://localhost:5000/apispec.json
```

Obtiene la especificaci√≥n OpenAPI completa en formato JSON (√∫til para Postman, Insomnia, etc).

---

## üìñ Endpoints Documentados

### üîê Autenticaci√≥n
| M√©todo | Endpoint | Descripci√≥n | Autenticaci√≥n |
|--------|----------|-------------|---------------|
| POST | `/api/usuarios/login` | Iniciar sesi√≥n | No |
| POST | `/api/usuarios/registro` | Registrar nuevo usuario | No |
| GET | `/api/usuarios/perfil` | Obtener perfil actual | S√≠ |
| PUT | `/api/usuarios/perfil` | Actualizar perfil actual | S√≠ |
| POST | `/api/usuarios/cambiar-password` | Cambiar contrase√±a | S√≠ |

### üë• Gesti√≥n de Usuarios (Admin/Jefe)
| M√©todo | Endpoint | Descripci√≥n | Rol Requerido |
|--------|----------|-------------|---------------|
| GET | `/api/usuarios/usuarios` | Listar usuarios | Jefe, Admin |
| GET | `/api/usuarios/usuarios/:id` | Obtener usuario espec√≠fico | Jefe, Admin |
| PUT | `/api/usuarios/usuarios/:id` | Actualizar usuario | Admin |
| DELETE | `/api/usuarios/usuarios/:id` | Eliminar usuario | Admin |

---

## üîß Ejemplo de Uso Paso a Paso

### 1. Abrir Swagger UI

Abre tu navegador en:
```
http://localhost:5000/api/docs
```

### 2. Hacer Login

1. Busca el endpoint **`POST /api/usuarios/login`** en la secci√≥n "Autenticaci√≥n"
2. Haz clic en el endpoint para expandirlo
3. Haz clic en el bot√≥n **"Try it out"**
4. Ingresa las credenciales en el campo de texto:

```json
{
  "email": "admin@solicitudes.com",
  "password": "admin123"
}
```

5. Haz clic en **"Execute"**
6. En la respuesta, copia el valor de `access_token`

**Ejemplo de respuesta:**
```json
{
  "message": "Login exitoso",
  "usuario": {
    "id": 1,
    "email": "admin@solicitudes.com",
    "nombre": "Admin",
    "rol": "administrador"
  },
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "Bearer"
}
```

### 3. Autenticarse en Swagger

1. En la parte superior derecha de la p√°gina, busca el bot√≥n **"Authorize"** (üîì candado)
2. Haz clic en √©l
3. En el campo que aparece, ingresa:
```
Bearer TU_ACCESS_TOKEN_AQUI
```
**Importante:** Debes incluir la palabra "Bearer" seguida de un espacio y luego tu token.

4. Haz clic en **"Authorize"**
5. Haz clic en **"Close"**

Ahora el candado se ver√° cerrado (üîí) y podr√°s acceder a todos los endpoints protegidos.

### 4. Probar un Endpoint Protegido

Ejemplo: Listar usuarios

1. Busca el endpoint **`GET /api/usuarios/usuarios`** en la secci√≥n "Usuarios"
2. Haz clic en **"Try it out"**
3. (Opcional) Configura filtros en los query parameters:
   - `rol`: empleado, jefe, o administrador
   - `activo`: true o false
   - `page`: n√∫mero de p√°gina
   - `per_page`: cantidad por p√°gina

4. Haz clic en **"Execute"**
5. Ver√°s la respuesta con la lista de usuarios

**Ejemplo de respuesta:**
```json
{
  "usuarios": [
    {
      "id": 1,
      "email": "admin@solicitudes.com",
      "nombre": "Admin",
      "rol": "administrador",
      "activo": true
    }
  ],
  "total": 1,
  "pages": 1,
  "current_page": 1,
  "per_page": 10
}
```

---

## üìù Ejemplos R√°pidos por Endpoint

### Login
```bash
# Desde Swagger
Endpoint: POST /api/usuarios/login
Body:
{
  "email": "admin@solicitudes.com",
  "password": "admin123"
}

# Desde curl
curl -X POST http://localhost:5000/api/usuarios/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@solicitudes.com","password":"admin123"}'
```

### Registrar Usuario
```bash
# Desde Swagger
Endpoint: POST /api/usuarios/registro
Body:
{
  "email": "nuevo@solicitudes.com",
  "password": "password123",
  "nombre": "Juan",
  "apellido": "P√©rez",
  "rol": "empleado"
}

# Desde curl
curl -X POST http://localhost:5000/api/usuarios/registro \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer TU_TOKEN" \
  -d '{
    "email":"nuevo@solicitudes.com",
    "password":"password123",
    "nombre":"Juan",
    "apellido":"P√©rez",
    "rol":"empleado"
  }'
```

### Obtener Perfil
```bash
# Desde Swagger (necesita autorizaci√≥n)
Endpoint: GET /api/usuarios/perfil
Headers: Authorization: Bearer TU_TOKEN

# Desde curl
curl http://localhost:5000/api/usuarios/perfil \
  -H "Authorization: Bearer TU_TOKEN"
```

### Actualizar Perfil
```bash
# Desde Swagger (necesita autorizaci√≥n)
Endpoint: PUT /api/usuarios/perfil
Body:
{
  "nombre": "Nuevo Nombre",
  "apellido": "Nuevo Apellido"
}

# Desde curl
curl -X PUT http://localhost:5000/api/usuarios/perfil \
  -H "Authorization: Bearer TU_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"nombre":"Nuevo Nombre","apellido":"Nuevo Apellido"}'
```

### Cambiar Contrase√±a
```bash
# Desde Swagger (necesita autorizaci√≥n)
Endpoint: POST /api/usuarios/cambiar-password
Body:
{
  "password_actual": "password123",
  "password_nueva": "newpassword456"
}

# Desde curl
curl -X POST http://localhost:5000/api/usuarios/cambiar-password \
  -H "Authorization: Bearer TU_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "password_actual":"password123",
    "password_nueva":"newpassword456"
  }'
```

### Listar Usuarios (Admin/Jefe)
```bash
# Desde Swagger (necesita autorizaci√≥n)
Endpoint: GET /api/usuarios/usuarios
Query params:
- rol: empleado
- activo: true
- page: 1
- per_page: 10

# Desde curl
curl "http://localhost:5000/api/usuarios/usuarios?rol=empleado&page=1&per_page=10" \
  -H "Authorization: Bearer TU_TOKEN"
```

### Obtener Usuario por ID (Admin/Jefe)
```bash
# Desde Swagger (necesita autorizaci√≥n)
Endpoint: GET /api/usuarios/usuarios/{usuario_id}
Path param: usuario_id = 5

# Desde curl
curl http://localhost:5000/api/usuarios/usuarios/5 \
  -H "Authorization: Bearer TU_TOKEN"
```

### Actualizar Usuario (Admin)
```bash
# Desde Swagger (necesita autorizaci√≥n)
Endpoint: PUT /api/usuarios/usuarios/{usuario_id}
Path param: usuario_id = 5
Body:
{
  "nombre": "Nuevo Nombre",
  "rol": "jefe",
  "activo": true
}

# Desde curl
curl -X PUT http://localhost:5000/api/usuarios/usuarios/5 \
  -H "Authorization: Bearer TU_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"nombre":"Nuevo Nombre","rol":"jefe","activo":true}'
```

### Eliminar Usuario (Admin)
```bash
# Desde Swagger (necesita autorizaci√≥n)
Endpoint: DELETE /api/usuarios/usuarios/{usuario_id}
Path param: usuario_id = 5

# Desde curl
curl -X DELETE http://localhost:5000/api/usuarios/usuarios/5 \
  -H "Authorization: Bearer TU_TOKEN"
```

---

## üé® Caracter√≠sticas de la Interfaz Swagger

### 1. **Navegaci√≥n por Tags**
Los endpoints est√°n organizados en categor√≠as:
- üîê **Autenticaci√≥n** - Login, registro, perfil
- üë• **Usuarios** - Gesti√≥n de usuarios (admin)
- üìã **Solicitudes** - CRUD de solicitudes
- üîî **Notificaciones** - Sistema de notificaciones
- ‚öïÔ∏è **Sistema** - Health check y utilidades

### 2. **Colores de M√©todos HTTP**
- üü¢ **GET** - Verde (consultas)
- üîµ **POST** - Azul (crear)
- üü† **PUT** - Naranja (actualizar)
- üî¥ **DELETE** - Rojo (eliminar)

### 3. **Informaci√≥n de Cada Endpoint**
Para cada endpoint ver√°s:
- **Descripci√≥n** - Qu√© hace el endpoint
- **Parameters** - Par√°metros requeridos/opcionales
- **Request Body** - Estructura del JSON de entrada
- **Responses** - Posibles respuestas con c√≥digos HTTP
- **Examples** - Valores de ejemplo
- **Security** - Si requiere autenticaci√≥n

### 4. **Try it out (Probar)**
El bot√≥n "Try it out" te permite:
- Editar los valores de ejemplo
- Ejecutar la petici√≥n real
- Ver el request HTTP completo (curl)
- Ver la respuesta en tiempo real

### 5. **Bot√≥n Authorize**
- Ubicado arriba a la derecha
- Te permite ingresar tu JWT token una sola vez
- Se aplica autom√°ticamente a todos los endpoints protegidos

---

## üîí Seguridad y Autenticaci√≥n

### Tipos de Endpoints

1. **P√∫blicos (sin üîí)**
   - `/api/usuarios/login`
   - `/api/usuarios/registro`
   - No requieren token

2. **Protegidos (con üîí)**
   - Todos los dem√°s endpoints
   - Requieren JWT token v√°lido
   - Token expira en 1 hora

### Formato del Token

Todos los endpoints protegidos requieren el header:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Roles y Permisos

- **empleado** - Puede crear y ver sus propias solicitudes
- **jefe** - Puede aprobar/rechazar solicitudes + listar usuarios
- **administrador** - Acceso completo, puede gestionar usuarios

---

## üõ†Ô∏è Configuraci√≥n T√©cnica

### Archivos Modificados

1. **`requirements.txt:9`**
   ```txt
   flasgger==0.9.7.1
   ```

2. **`app/__init__.py:63-110`**
   - Configuraci√≥n de Swagger
   - Template personalizado
   - Definici√≥n de seguridad JWT

3. **`app/routes/auth.py`**
   - Documentaci√≥n de todos los endpoints de autenticaci√≥n
   - Documentaci√≥n de gesti√≥n de usuarios

### Configuraci√≥n de Swagger

```python
swagger_config = {
    "specs_route": "/api/docs"  # URL de la interfaz
}

swagger_template = {
    "info": {
        "title": "API de Solicitudes",
        "description": "Documentaci√≥n interactiva...",
        "version": "1.0.0"
    },
    "securityDefinitions": {
        "Bearer": {
            "type": "apiKey",
            "name": "Authorization",
            "in": "header"
        }
    }
}
```

### Formato de Documentaci√≥n en Endpoints

```python
@auth_bp.route('/login', methods=['POST'])
def login():
    """
    Iniciar sesi√≥n en el sistema
    ---
    tags:
      - Autenticaci√≥n
    parameters:
      - in: body
        name: body
        required: true
        schema:
          type: object
          properties:
            email:
              type: string
            password:
              type: string
    responses:
      200:
        description: Login exitoso
    """
    # C√≥digo del endpoint...
```

---

## üìä Exportar Documentaci√≥n

### Opci√≥n 1: Descargar Especificaci√≥n OpenAPI

```bash
# Descargar como JSON
curl http://localhost:5000/apispec.json > api-spec.json

# Descargar como YAML (con conversi√≥n)
curl http://localhost:5000/apispec.json | python3 -c "import sys, yaml, json; yaml.dump(json.load(sys.stdin), sys.stdout)" > api-spec.yaml
```

### Opci√≥n 2: Importar a Otras Herramientas

**Postman:**
1. File ‚Üí Import
2. Link: `http://localhost:5000/apispec.json`

**Insomnia:**
1. Application ‚Üí Preferences ‚Üí Data
2. Import Data ‚Üí From URL
3. URL: `http://localhost:5000/apispec.json`

---

## üêõ Troubleshooting

### Problema: No puedo acceder a /api/docs

**Soluci√≥n:**
```bash
# Verificar que la API est√© corriendo
curl http://localhost:5000/health

# Si no responde, iniciar Docker
cd /mnt/c/Users/aleja/solicitudes-api
docker compose up -d

# Verificar logs
docker compose logs -f api
```

### Problema: "Could not resolve host"

**Soluci√≥n:**
- Aseg√∫rate de que Docker est√© corriendo
- Verifica que el contenedor `solicitudes-api` est√© activo:
  ```bash
  docker compose ps
  ```

### Problema: "Unauthorized" en endpoints protegidos

**Soluci√≥n:**
1. Haz login en `/api/usuarios/login`
2. Copia el `access_token`
3. Haz clic en **"Authorize"** (candado verde)
4. Ingresa: `Bearer TU_TOKEN`
5. Intenta de nuevo

### Problema: Token expirado

**Soluci√≥n:**
- Los tokens expiran en 1 hora
- Haz login nuevamente para obtener un nuevo token
- Actualiza la autorizaci√≥n en Swagger

### Problema: No veo mis endpoints personalizados

**Soluci√≥n:**
- Aseg√∫rate de que el endpoint tenga docstring con formato YAML
- Debe incluir la l√≠nea `---` despu√©s de la descripci√≥n
- Reconstruye el contenedor: `docker compose up -d --build`

---

## üí° Tips y Mejores Pr√°cticas

### 1. **Mant√©n el token a mano**
Guarda tu token en un archivo de texto mientras desarrollas:
```bash
# Hacer login y guardar token
curl -X POST http://localhost:5000/api/usuarios/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@solicitudes.com","password":"admin123"}' \
  | jq -r '.access_token' > token.txt

# Usar el token guardado
TOKEN=$(cat token.txt)
curl http://localhost:5000/api/usuarios/perfil \
  -H "Authorization: Bearer $TOKEN"
```

### 2. **Usa la pesta√±a de Models**
En la parte inferior de Swagger, hay una secci√≥n "Models" que muestra:
- Todos los esquemas de datos
- Estructura completa de objetos
- Tipos de datos

### 3. **Copia el comando curl**
Despu√©s de hacer "Execute", Swagger muestra el comando curl equivalente. √ötil para:
- Automatizar tests
- Compartir con el equipo
- Debugging

### 4. **Filtra por tag**
Si solo quieres ver endpoints de autenticaci√≥n:
- Colapsa los dem√°s tags
- O busca usando Ctrl+F

### 5. **Prueba diferentes c√≥digos de error**
Prueba casos de error para ver las respuestas:
- Email incorrecto en login (401)
- Token inv√°lido (401)
- Datos faltantes (400)
- Recurso no encontrado (404)

---

## üîó Enlaces √ötiles

### URLs del Sistema
```
Frontend:       http://localhost:5173
Backend API:    http://localhost:5000
Swagger UI:     http://localhost:5000/api/docs
API Spec:       http://localhost:5000/apispec.json
Health Check:   http://localhost:5000/health
```

### Credenciales por Defecto
```
Admin:
  Email: admin@solicitudes.com
  Password: admin123

Jefe:
  Email: jefe@solicitudes.com
  Password: jefe123

Empleado:
  Email: empleado@solicitudes.com
  Password: empleado123
```

### Documentaci√≥n Relacionada
- [SISTEMA_COMPLETO.md](./SISTEMA_COMPLETO.md) - Documentaci√≥n completa del sistema
- [COMO_USAR_LA_API.md](./COMO_USAR_LA_API.md) - Gu√≠a pr√°ctica de la API
- [COMO_AGREGAR_USUARIOS.md](./COMO_AGREGAR_USUARIOS.md) - Gesti√≥n de usuarios

---

## üìà Ventajas de Usar Swagger

‚úÖ **Documentaci√≥n siempre actualizada** - Se genera del c√≥digo fuente
‚úÖ **Testing interactivo** - No necesitas Postman ni curl
‚úÖ **Onboarding r√°pido** - Nuevos desarrolladores entienden la API r√°pido
‚úÖ **Est√°ndar OpenAPI** - Compatible con miles de herramientas
‚úÖ **Ejemplos autom√°ticos** - Cada endpoint tiene ejemplos claros
‚úÖ **Validaci√≥n en tiempo real** - Ves errores antes de enviar
‚úÖ **Exportable** - Puedes compartir la especificaci√≥n

---

## üìû Soporte

Si tienes problemas con Swagger:

1. **Revisa los logs:**
   ```bash
   docker compose logs -f api
   ```

2. **Verifica la especificaci√≥n:**
   ```bash
   curl http://localhost:5000/apispec.json | python3 -m json.tool
   ```

3. **Reconstruye el contenedor:**
   ```bash
   docker compose down
   docker compose up -d --build
   ```

---

**¬°Listo para explorar tu API! üöÄ**

Abre [http://localhost:5000/api/docs](http://localhost:5000/api/docs) y comienza a probar tus endpoints.
